#!/bin/bash

if [ $# -eq 0 ]
then
  TARGET_DIR="../aarron-lee.github.io"
else
  TARGET_DIR="$@"
fi

echo "Target directory is $TARGET_DIR"

if [ -d "../.tmp_build" ]
then
  echo "tmp build directory exists"
else
  mkdir "../.tmp_build"
  echo "tmp build directory created"
fi

echo "building static site..."

npm run build

echo "build is complete! moving them to the relevant locations"
# output is stored to public dir

mv "$TARGET_DIR/CNAME" "../.tmp_build"
mv "$TARGET_DIR/LICENSE" "../.tmp_build"
mv "$TARGET_DIR/README.md" "../.tmp_build"

rm -rf $TARGET_DIR/*

cp -R public/* $TARGET_DIR/

mv "../.tmp_build/CNAME" "$TARGET_DIR/CNAME"
mv "../.tmp_build/LICENSE" "$TARGET_DIR/LICENSE"
mv "../.tmp_build/README.md" "$TARGET_DIR/README.md"

[ -d "../.tmp_build" ] && rmdir "../.tmp_build"

echo "build files successfully moved!"